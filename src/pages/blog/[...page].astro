---
// src/pages/blog/[...page].astro
export const prerender = true; // <--- AÑADE ESTA LÍNEA AL PRINCIPIO

import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import type { Page } from 'astro';  // ← Para tipado perfecto de 'page'

// Tipado oficial para Props
interface Props {
  page: Page<CollectionEntry<'blog'>>;
}

export async function getStaticPaths({ paginate }: { paginate: (items: CollectionEntry<'blog'>[], options?: { pageSize?: number }) => unknown }) {  // ← ¡AQUÍ ESTÁ LA MAGIA! paginate viene del argumento
  const posts = await getCollection('blog');
  const sortedPosts = posts.sort(
    (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
  );

  return paginate(sortedPosts, { pageSize: 3 });  // ← Sin @ts-ignore, porque ahora está tipado
}

const { page } = Astro.props as Props;
---

<Layout title={`Blog${page.currentPage > 1 ? ` - Página ${page.currentPage}` : ''}`}>
  <main class="container mx-auto px-4 py-12">
    <h1 class="text-4xl md:text-5xl font-extrabold text-center mb-12 text-gray-900">Blog</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
      {page.data.map((post: CollectionEntry<'blog'>) => (
        <article class="relative bg-white rounded-xl shadow-lg h-full flex flex-col transition-all duration-300 ease-in-out hover:-translate-y-2 hover:shadow-2xl">
          <div class="p-6 flex flex-col flex-grow">
            <h3 class="text-xl font-bold mb-2">
              <a href={`/blog/${post.slug}`} class="text-gray-900 hover:text-blue-600 transition-colors stretched-link">
                {post.data.title}
              </a>
            </h3>
            <p class="text-gray-500 text-sm mb-3 flex items-center gap-1.5">
              <i class="bi bi-calendar3"></i>
              <span>{post.data.pubDate.toLocaleDateString('es-ES')} • {post.data.author}</span>
            </p>
            <p class="text-gray-700 flex-grow">{post.data.description}</p>
            <div class="mt-4 flex gap-2 flex-wrap items-center">
              {post.data.tags.map((tag: string) => (
                <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">{tag}</span>
              ))}
              <a href={`/blog/${post.slug}`} class="ml-auto text-blue-600 hover:text-blue-800 font-semibold text-sm">
                Leer más →
              </a>
            </div>
          </div>
        </article>
      ))}
    </div>

    <!-- Paginación con Tailwind -->
    {page.lastPage > 1 && (
      <nav aria-label="Paginación del blog" class="mt-12">
        <ul class="flex justify-center items-center space-x-2 text-base">
          {page.url.prev && (
            <li>
              <a class="px-4 py-2 rounded-md text-gray-700 bg-white hover:bg-gray-100 transition-colors" href={page.url.prev} aria-label="Página anterior">
                ← Anterior
              </a>
            </li>
          )}
          {Array.from({ length: page.lastPage }, (_, i) => i + 1).map(n => (
            <li>
              <a class={`px-4 py-2 rounded-md transition-colors ${n === page.currentPage ? 'bg-blue-600 text-white font-bold pointer-events-none' : 'bg-white text-gray-700 hover:bg-gray-100'}`} href={n === 1 ? '/blog' : `/blog/${n}`} aria-label={`Ir a página ${n}`}>
                {n}
              </a>
            </li>
          ))}
          {page.url.next && (
            <li>
              <a class="px-4 py-2 rounded-md text-gray-700 bg-white hover:bg-gray-100 transition-colors" href={page.url.next} aria-label="Página siguiente">
                Siguiente →
              </a>
            </li>
          )}
        </ul>
      </nav>
    )}
  </main>
</Layout>